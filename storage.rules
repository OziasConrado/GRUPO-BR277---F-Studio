
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // REGRA 1: Permite leitura pública de todos os arquivos.
    // Isso é necessário para que as imagens do feed, avatares, etc.,
    // possam ser visualizados por todos os usuários.
    match /{allPaths=**} {
      allow read;
    }

    // REGRA 2: FOTOS DE PERFIL
    // Apenas o usuário autenticado pode salvar em sua própria pasta de perfil.
    // Limita o tamanho para 5MB e o tipo para imagem.
    match /profile_pictures/{userId}/{fileName} {
      allow write: if request.auth != null 
                    && request.auth.uid == userId
                    && request.resource.size < 5 * 1024 * 1024
                    && request.resource.contentType.matches('image/.*');
    }

    // REGRA 3: IMAGENS DO FEED E CHAT
    // Apenas o usuário autenticado pode salvar em sua própria pasta de imagens.
    // Limita o tamanho para 10MB e o tipo para imagem.
    match /images/{userId}/{fileName} {
      allow write: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.size < 10 * 1024 * 1024
                    && request.resource.contentType.matches('image/.*');
    }
    match /chat_images/{userId}/{fileName} {
      allow write: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.size < 10 * 1024 * 1024
                    && request.resource.contentType.matches('image/.*');
    }

    // REGRA 4: VÍDEOS (REELS)
    // Apenas o usuário autenticado pode salvar em sua própria pasta de vídeos.
    // Limita o tamanho para 50MB e o tipo para vídeo.
    match /videos/{userId}/{fileName} {
      allow write: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.size < 50 * 1024 * 1024
                    && request.resource.contentType.matches('video/.*');
    }

    // REGRA 5: ÁUDIOS DO CHAT
    // Apenas o usuário autenticado pode salvar em sua própria pasta de áudios.
    // Limita o tamanho para 10MB e o tipo para áudio.
    match /chat_audio/{userId}/{fileName} {
      allow write: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.size < 10 * 1024 * 1024
                    && request.resource.contentType.matches('audio/.*');
    }

    // REGRA 6: IMAGENS INDICADAS (TURISMO)
    // Apenas o usuário autenticado pode enviar imagens de sugestões.
    // Limita o tamanho para 5MB e o tipo para imagem.
    match /indicated_points_images/{userId}/{fileName} {
      allow write: if request.auth != null
                    && request.auth.uid == userId
                    && request.resource.size < 5 * 1024 * 1024
                    && request.resource.contentType.matches('image/.*');
    }
  }
}
