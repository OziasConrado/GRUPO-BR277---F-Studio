
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // Regra geral: Leitura pública para todos os arquivos
    match /{allPaths=**} {
      allow read;
    }

    // --- REGRAS DE ESCRITA ESPECÍFICAS (COM VALIDAÇÃO) ---
    
    // Fotos de perfil: Apenas imagens, até 5MB
    match /profile_pictures/{userId}/{fileName} {
      allow write: if request.auth != null && 
                      request.auth.uid == userId &&
                      request.resource.size < 5 * 1024 * 1024 &&
                      request.resource.contentType.matches('image/.*');
    }

    // Posts: Apenas imagens, até 10MB
    match /posts/{userId}/{fileName} {
      allow write: if request.auth != null && 
                      request.auth.uid == userId &&
                      request.resource.size < 10 * 1024 * 1024 &&
                      request.resource.contentType.matches('image/.*');
    }
    
    // Reels: Apenas vídeos, até 50MB
    match /reels/{userId}/{fileName} {
      allow write: if request.auth != null && 
                      request.auth.uid == userId &&
                      request.resource.size < 50 * 1024 * 1024 &&
                      request.resource.contentType.matches('video/.*');
    }

    // Chat - Imagens: Apenas imagens, até 10MB
    match /chat_images/{userId}/{fileName} {
      allow write: if request.auth != null && 
                      request.auth.uid == userId &&
                      request.resource.size < 10 * 1024 * 1024 &&
                      request.resource.contentType.matches('image/.*');
    }
    // Chat - Áudio: Apenas áudio, até 10MB
    match /chat_audio/{userId}/{fileName} {
      allow write: if request.auth != null && 
                      request.auth.uid == userId &&
                      request.resource.size < 10 * 1024 * 1024 &&
                      request.resource.contentType.matches('audio/.*');
    }

    // Pontos turísticos: Apenas imagens, até 10MB
    match /indicated_points_images/{userId}/{fileName} {
      allow write: if request.auth != null && 
                      request.auth.uid == userId &&
                      request.resource.size < 10 * 1024 * 1024 &&
                      request.resource.contentType.matches('image/.*');
    }
  }
}
