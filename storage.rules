rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Permite leitura pública para todas as imagens e vídeos,
    // pois as URLs são públicas após o upload.
    match /{allPaths=**} {
      allow read;
    }

    // Regra para fotos de perfil:
    // O usuário só pode escrever na sua própria pasta.
    // Ex: /profile_pictures/UID_DO_USUARIO/nome_do_arquivo.jpg
    match /profile_pictures/{userId}/{fileName} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Regra para imagens de posts:
    // O usuário só pode escrever na sua própria pasta de posts.
    match /posts/{userId}/{fileName} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Regra para vídeos (reels):
    // O usuário só pode escrever na sua própria pasta de reels.
    match /reels/{userId}/{fileName} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Regra para imagens do chat
    match /chat_images/{userId}/{fileName} {
       allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Regra para áudios do chat
     match /chat_audio/{userId}/{fileName} {
       allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Regra para imagens de pontos turisticos indicados
    match /indicated_points_images/{userId}/{fileName} {
       allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regra para outras pastas (ex: 'misc')
    match /{folder}/{userId}/{fileName} {
       allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
