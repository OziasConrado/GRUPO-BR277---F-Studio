rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // Função para verificar se o usuário é o proprietário do diretório
    function isOwner(userId) {
      return request.auth != null && request.auth.uid == userId;
    }

    // Permitir leitura pública para todos os arquivos por padrão.
    // Isso é simples e aceitável para um aplicativo social onde o conteúdo é público.
    allow read;

    // Regra geral para proteger o acesso de escrita
    match /{path=**} {
      allow write: if false; // Nega escrita por padrão
    }

    // Regras específicas de escrita por pasta
    match /profile_pictures/{userId}/{fileName} {
      allow write: if isOwner(userId)
                    && request.resource.size < 5 * 1024 * 1024 // Max 5MB
                    && request.resource.contentType.matches('image/.*');
    }

    match /images/{userId}/{fileName} {
        allow write: if isOwner(userId)
                      && request.resource.size < 10 * 1024 * 1024 // Max 10MB
                      && request.resource.contentType.matches('image/.*');
    }

    match /videos/{userId}/{fileName} {
        allow write: if isOwner(userId)
                      && request.resource.size < 50 * 1024 * 1024 // Max 50MB
                      && request.resource.contentType.matches('video/.*');
    }

    match /chat_images/{userId}/{fileName} {
         allow write: if isOwner(userId)
                      && request.resource.size < 10 * 1024 * 1024 // Max 10MB
                      && request.resource.contentType.matches('image/.*');
    }

    match /chat_audio/{userId}/{fileName} {
         allow write: if isOwner(userId)
                      && request.resource.size < 10 * 1024 * 1024 // Max 10MB
                      && request.resource.contentType.matches('audio/.*');
    }
    
    match /indicated_points_images/{userId}/{fileName} {
        allow write: if isOwner(userId)
                      && request.resource.size < 5 * 1024 * 1024 // Max 5MB
                      && request.resource.contentType.matches('image/.*');
    }
  }
}
