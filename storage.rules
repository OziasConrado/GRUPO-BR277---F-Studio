
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Por padrão, permite que qualquer pessoa leia todos os arquivos, 
    // mas ninguém pode escrever (a menos que seja permitido por uma regra mais específica abaixo).
    // Isso é necessário para que as imagens de perfil, posts, etc., sejam visíveis para todos no aplicativo.
    match /{allPaths=**} {
      allow read;
      allow write: if false;
    }

    // Esta regra permite que um usuário autenticado escreva em qualquer pasta que esteja
    // diretamente dentro de uma pasta com seu ID de usuário.
    // Ex: /profile_pictures/{userId}/minha_foto.jpg
    // Ex: /images/{userId}/imagem_do_post.png
    // Isso cobre todos os nossos casos de upload (perfil, feed, chat, etc.).
    match /{folder}/{userId}/{allPaths=**} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
